-- phpMyAdmin SQL Dump
-- version 5.2.1
-- https://www.phpmyadmin.net/
--
-- ホスト: 127.0.0.1
-- 生成日時: 2023-11-16 18:14:35
-- サーバのバージョン： 10.4.28-MariaDB
-- PHP のバージョン: 8.2.4

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- データベース: `main`
--

-- --------------------------------------------------------

--
-- テーブルの構造 `tags`
--

CREATE TABLE `tags` (
  `name` varchar(11) NOT NULL,
  `priority` int(11) NOT NULL,
  `color` varchar(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- テーブルのデータのダンプ `tags`
--

INSERT INTO `tags` (`name`, `priority`, `color`) VALUES
('TD系', 1101, NULL),
('主要', 1001, 'blue'),
('参考', 1002, 'green'),
('右屋根', 1301, NULL),
('妥協系', 1202, NULL),
('左屋根', 1302, NULL),
('理想形', 1201, NULL);

-- --------------------------------------------------------

--
-- テーブルの構造 `tag_maps`
--

CREATE TABLE `tag_maps` (
  `template_id` varchar(11) NOT NULL,
  `tag_name` varchar(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- テーブルのデータのダンプ `tag_maps`
--

INSERT INTO `tag_maps` (`template_id`, `tag_name`) VALUES
('1FEB7815', 'TD系'),
('1FEB7815', '参考'),
('1FEB7815', '右屋根'),
('1FEB7815', '妥協系'),
('28E727FD', 'TD系'),
('28E727FD', '主要'),
('28E727FD', '右屋根'),
('28E727FD', '妥協系'),
('31378743', 'TD系'),
('31378743', '主要'),
('31378743', '右屋根'),
('31378743', '妥協系'),
('3847AD94', 'TD系'),
('3847AD94', '主要'),
('3847AD94', '右屋根'),
('3847AD94', '理想形'),
('3B86A49B', 'TD系'),
('3B86A49B', '主要'),
('3B86A49B', '左屋根'),
('3B86A49B', '理想形'),
('46B345EA', '主要'),
('46B345EA', '右屋根'),
('49EC9D33', 'TD系'),
('49EC9D33', '参考'),
('49EC9D33', '右屋根'),
('49EC9D33', '妥協系'),
('664FC315', 'TD系'),
('664FC315', '主要'),
('664FC315', '左屋根'),
('664FC315', '理想形'),
('670F3CC6', '主要'),
('670F3CC6', '右屋根'),
('680D57E7', 'TD系'),
('680D57E7', '参考'),
('680D57E7', '左屋根'),
('680D57E7', '理想形'),
('691F4048', 'TD系'),
('691F4048', '主要'),
('691F4048', '妥協系'),
('691F4048', '左屋根'),
('726ACAAE', 'TD系'),
('726ACAAE', '主要'),
('726ACAAE', '左屋根'),
('726ACAAE', '理想形'),
('7413B3CF', 'TD系'),
('7413B3CF', '参考'),
('7413B3CF', '右屋根'),
('7413B3CF', '妥協系'),
('74388856', 'TD系'),
('74388856', '主要'),
('74388856', '右屋根'),
('74388856', '理想形'),
('7B888F2D', 'TD系'),
('7B888F2D', '主要'),
('7B888F2D', '右屋根'),
('7B888F2D', '妥協系'),
('8396D84D', 'TD系'),
('8396D84D', '参考'),
('8396D84D', '妥協系'),
('8396D84D', '左屋根'),
('8CF816AD', '主要'),
('8CF816AD', '左屋根'),
('94A33995', 'TD系'),
('94A33995', '参考'),
('94A33995', '妥協系'),
('94A33995', '左屋根'),
('960076A9', 'TD系'),
('960076A9', '参考'),
('960076A9', '妥協系'),
('960076A9', '左屋根'),
('A803499B', 'TD系'),
('A803499B', '主要'),
('A803499B', '右屋根'),
('A803499B', '理想形'),
('AB417000', 'TD系'),
('AB417000', '参考'),
('AB417000', '妥協系'),
('AB417000', '左屋根'),
('BA781180', 'TD系'),
('BA781180', '参考'),
('BA781180', '右屋根'),
('BA781180', '妥協系'),
('C83BF49E', 'TD系'),
('C83BF49E', '参考'),
('C83BF49E', '妥協系'),
('C83BF49E', '左屋根'),
('CC2BDD9F', '主要'),
('CC2BDD9F', '左屋根'),
('D7580A04', 'TD系'),
('D7580A04', '参考'),
('D7580A04', '妥協系'),
('D7580A04', '左屋根'),
('D9B806DB', 'TD系'),
('D9B806DB', '参考'),
('D9B806DB', '右屋根'),
('D9B806DB', '妥協系'),
('DD22F4DE', 'TD系'),
('DD22F4DE', '参考'),
('DD22F4DE', '妥協系'),
('DD22F4DE', '左屋根'),
('E03BF8BC', 'TD系'),
('E03BF8BC', '参考'),
('E03BF8BC', '妥協系'),
('E03BF8BC', '左屋根'),
('E23154FF', 'TD系'),
('E23154FF', '主要'),
('E23154FF', '右屋根'),
('E23154FF', '妥協系'),
('E41EE4AE', 'TD系'),
('E41EE4AE', '参考'),
('E41EE4AE', '右屋根'),
('E41EE4AE', '妥協系'),
('EC483DB9', 'TD系'),
('EC483DB9', '参考'),
('EC483DB9', '妥協系'),
('EC483DB9', '左屋根'),
('EFF0D856', 'TD系'),
('EFF0D856', '参考'),
('EFF0D856', '右屋根'),
('EFF0D856', '妥協系'),
('F56C00A8', 'TD系'),
('F56C00A8', '参考'),
('F56C00A8', '妥協系'),
('F56C00A8', '左屋根'),
('F7A65CC6', 'TD系'),
('F7A65CC6', '主要'),
('F7A65CC6', '右屋根'),
('F7A65CC6', '理想形');

-- --------------------------------------------------------

--
-- テーブルの構造 `templates`
--

CREATE TABLE `templates` (
  `id` varchar(11) NOT NULL DEFAULT '0',
  `name` text NOT NULL DEFAULT '',
  `minos` text DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- テーブルのデータのダンプ `templates`
--

INSERT INTO `templates` (`id`, `name`, `minos`) VALUES
('1FEB7815', 'はちみつ砲', '1024,2054,3330,4372,5137,6147,7195,1066,2343,4402,5151,6167,7214'),
('28E727FD', '迷走砲', '1032,2304,3332,4353,5894,6402,7195,1055,2343,4631,5434,6442,7214'),
('31378743', '迷走砲', '1032,2304,3332,4353,5894,6402,7198,1066,2333,4631,5678,6427,7475'),
('3847AD94', 'はちみつ砲', '1024,2054,3330,4372,5137,6147,7195,1055,2343,4896,5688,6167,7214'),
('3B86A49B', 'はちみつ砲', '1032,2048,3846,4106,5916,6164,7172,1061,2334,4659,5412,6185,7192'),
('46B345EA', 'TKI', '1028,2048,3334,4633,5896,6156,7435,4902'),
('49EC9D33', '迷走砲', '1032,2304,3332,4353,5894,6402,7195,1075,2104,4631,5669,6430,7456'),
('664FC315', 'はちみつ砲', '1032,2048,3846,4106,5916,6164,7172,1070,2108,4132,5406,6185,7192'),
('670F3CC6', 'TKI', '1034,2048,3609,4902,5896,6149,7428'),
('680D57E7', '迷走砲', '1024,2313,3844,4354,5895,6164,7430,1076,2334,4393,5656,6436,7462'),
('691F4048', 'はちみつ砲', '1032,2048,3846,4106,5916,6164,7172,1092,2334,4388,5414,6185,7192'),
('726ACAAE', 'はちみつ砲', '1032,2048,3846,4106,5916,6164,7172,1065,2334,4388,5683,6437,7192'),
('7413B3CF', 'はちみつ砲', '1024,2054,3330,4372,5137,6147,7195,1055,2343,4896,5434,6167,7214'),
('74388856', 'はちみつ砲', '1024,2054,3330,4372,5137,6147,7195,1066,2114,4902,5151,6167,7214'),
('7B888F2D', '迷走砲', '1032,2304,3332,4353,5894,6402,7195,1055,2343,4631,5427,6442,7214'),
('8396D84D', '迷走砲', '1024,2313,3844,4354,5895,6181,7430,1070,2324,4649,5656,6457,7445'),
('8CF816AD', 'TKI', '1028,2054,3842,4352,5654,6417,7183,5406'),
('94A33995', '迷走砲', '1024,2313,3844,4354,5895,6164,7430,1061,2334,4921,5656,6185,7470'),
('960076A9', 'はちみつ砲', '1032,2048,3846,4106,5916,6164,7172,1070,2334,4132,5946,6185,7192'),
('A803499B', '迷走砲', '1032,2304,3332,4353,5894,6402,7195,1080,2343,4631,5935,6430,7456'),
('AB417000', '迷走砲', '1024,2313,3844,4354,5895,6164,7430,1081,2098,4638,5656,6436,7462'),
('BA781180', 'はちみつ砲', '1024,2054,3330,4372,5137,6147,7195,1055,2104,4896,5669,6167,7475'),
('C83BF49E', '迷走砲', '1024,2313,3844,4354,5895,6164,7430,1080,2334,4400,5656,6185,7204'),
('CC2BDD9F', 'TKI', '1042,2054,3606,4352,5406,6404,7170'),
('D7580A04', 'はちみつ砲', '1032,2048,3846,4106,5916,6164,7172,1061,2098,4638,5412,6457,7192'),
('D9B806DB', '迷走砲', '1032,2304,3332,4353,5894,6402,7195,1055,2104,4631,5669,6442,7464'),
('DD22F4DE', '迷走砲', '1024,2313,3844,4354,5895,6164,7430,1061,2098,4638,5656,6448,7470'),
('E03BF8BC', 'はちみつ砲', '1032,2048,3846,4106,5916,6164,7172,1061,2334,4914,5412,6185,7192'),
('E23154FF', 'はちみつ砲', '1024,2054,3330,4372,5137,6147,7195,1084,2343,4894,5920,6167,7214'),
('E41EE4AE', '迷走砲', '1032,2304,3332,4353,5894,6402,7195,1076,2343,4631,5928,6175,7214'),
('EC483DB9', '迷走砲', '1024,2313,3844,4354,5895,6164,7430,1061,2334,4914,5656,6185,7470'),
('EFF0D856', '迷走砲', '1032,2304,3332,4353,5894,6402,7195,1066,2104,4631,5669,6194,7198'),
('F56C00A8', '迷走砲', '1024,2313,3844,4354,5895,6164,7430,1070,2098,4638,5656,6181,7225'),
('F7A65CC6', 'はちみつ砲', '1024,2054,3330,4372,5137,6147,7195,1071,2343,4664,5920,6167,7455');

--
-- トリガ `templates`
--
DELIMITER $$
CREATE TRIGGER `ID_INSERT` BEFORE INSERT ON `templates` FOR EACH ROW BEGIN
  SET NEW.id = HEX(CRC32(CONCAT(NEW.name,NEW.minos)));
END
$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER `ID_UPDATE` BEFORE UPDATE ON `templates` FOR EACH ROW BEGIN
  SET NEW.id = HEX(CRC32(CONCAT(NEW.name,NEW.minos)));
END
$$
DELIMITER ;

-- --------------------------------------------------------

--
-- ビュー用の代替構造 `templates_view`
-- (実際のビューを参照するには下にあります)
--
CREATE TABLE `templates_view` (
`id` varchar(11)
,`name` text
,`tags` mediumtext
,`minos` text
);

-- --------------------------------------------------------

--
-- ビュー用の構造 `templates_view`
--
DROP TABLE IF EXISTS `templates_view`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY INVOKER VIEW `templates_view`  AS SELECT `templates`.`id` AS `id`, `templates`.`name` AS `name`, group_concat(`tags`.`name` order by `tags`.`priority` ASC separator ',') AS `tags`, `templates`.`minos` AS `minos` FROM ((`templates` left join `tag_maps` on(`templates`.`id` = `tag_maps`.`template_id`)) left join `tags` on(`tags`.`name` = `tag_maps`.`tag_name`)) GROUP BY `templates`.`id` ORDER BY `templates`.`name` ASC, group_concat(`tags`.`priority` order by `tags`.`priority` ASC separator ',') ASC ;

--
-- ダンプしたテーブルのインデックス
--

--
-- テーブルのインデックス `tags`
--
ALTER TABLE `tags`
  ADD PRIMARY KEY (`name`);

--
-- テーブルのインデックス `tag_maps`
--
ALTER TABLE `tag_maps`
  ADD UNIQUE KEY `template_id` (`template_id`,`tag_name`);

--
-- テーブルのインデックス `templates`
--
ALTER TABLE `templates`
  ADD PRIMARY KEY (`id`);
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
