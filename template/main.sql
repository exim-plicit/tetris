-- phpMyAdmin SQL Dump
-- version 5.2.1
-- https://www.phpmyadmin.net/
--
-- ホスト: 127.0.0.1
-- 生成日時: 2023-11-19 20:41:21
-- サーバのバージョン： 10.4.28-MariaDB
-- PHP のバージョン: 8.2.4

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- データベース: `main`
--

-- --------------------------------------------------------

--
-- テーブルの構造 `opener`
--

CREATE TABLE `opener` (
  `id` varchar(11) NOT NULL DEFAULT '0',
  `name` text NOT NULL DEFAULT '',
  `minos` text DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- テーブルのデータのダンプ `opener`
--

INSERT INTO `opener` (`id`, `name`, `minos`) VALUES
('10FC6E0B', 'ガムシロ積み', '1024,2306,3331,4103,5908,6148,7442,1084,2353,4901,5406,6168,7200'),
('15E1B568', 'ガムシロ積み', '1024,2306,3331,4103,5908,6148,7442,1076,2353,4901,5406,6168,7200'),
('1FEB7815', 'はちみつ砲', '1024,2054,3330,4372,5137,6147,7195,1066,2343,4402,5151,6167,7214'),
('23B8158F', 'はちみつ砲', '1024,2054,3330,4372,5137,6147,7195,1066,2114,4902,5151,6167,7214'),
('28E727FD', '迷走砲', '1032,2304,3332,4353,5894,6402,7195,1055,2343,4631,5434,6442,7214'),
('2F8C5C46', '皐月積み', '1031,2304,3845,4353,5915,6430,7171,1075,2313,4668,5155,6445,7191'),
('30825BEA', 'TKI積み', '1034,2048,3609,4902,5896,6149,7428'),
('31378743', '迷走砲', '1032,2304,3332,4353,5894,6402,7198,1066,2333,4631,5678,6427,7475'),
('322F5852', 'TKI積み', '1028,2054,3842,4352,5654,6417,7183,5406'),
('336024B2', '皐月積み', '1031,2304,3845,4353,5939,6430,7171,1084,2313,4891,5411,6426,7191'),
('341A5D28', 'ガムシロ積み', '1032,2311,3845,4380,5120,6410,7171,1092,2344,4902,5407,6179,7191'),
('3B86A49B', 'はちみつ砲', '1032,2048,3846,4106,5916,6164,7172,1061,2334,4659,5412,6185,7192'),
('49EC9D33', '迷走砲', '1032,2304,3332,4353,5894,6402,7195,1075,2104,4631,5669,6430,7456'),
('4B02ED33', '皐月積み', '1031,2304,3845,4353,5939,6430,7171,1084,2313,4387,5915,6436,7191'),
('4FDC0D06', 'ガムシロ積み', '1032,2311,3845,4380,5120,6410,7171,1080,2344,4902,5407,6179,7191'),
('5FB6CD4D', '皐月積み', '1025,2313,3331,4409,5895,6148,7462,1092,2304,4897,5397,6168,7446'),
('664FC315', 'はちみつ砲', '1032,2048,3846,4106,5916,6164,7172,1070,2108,4132,5406,6185,7192'),
('670D39C8', 'TKI積み', '1042,2054,3606,4352,5406,6404,7170'),
('680D57E7', '迷走砲', '1024,2313,3844,4354,5895,6164,7430,1076,2334,4393,5656,6436,7462'),
('691F4048', 'はちみつ砲', '1032,2048,3846,4106,5916,6164,7172,1092,2334,4388,5414,6185,7192'),
('6FC7304D', 'はちみつ砲', '1024,2054,3330,4372,5137,6147,7195,1055,2343,4896,5688,6167,7214'),
('726ACAAE', 'はちみつ砲', '1032,2048,3846,4106,5916,6164,7172,1065,2334,4388,5683,6437,7192'),
('7413B3CF', 'はちみつ砲', '1024,2054,3330,4372,5137,6147,7195,1055,2343,4896,5434,6167,7214'),
('7A2EA849', '皐月積み', '1025,2313,3331,4373,5895,6148,7462,1092,2304,4409,5921,6168,7456'),
('7B888F2D', '迷走砲', '1032,2304,3332,4353,5894,6402,7195,1055,2343,4631,5427,6442,7214'),
('82553D4F', 'ガムシロ積み', '1032,2311,3845,4380,5120,6410,7171,1085,2344,4902,5407,6179,7191'),
('8396D84D', '迷走砲', '1024,2313,3844,4354,5895,6181,7430,1070,2324,4649,5656,6457,7445'),
('8D173318', '皐月積み', '1025,2313,3331,4409,5895,6148,7462,1092,2304,4373,5921,6168,7456'),
('94A33995', '迷走砲', '1024,2313,3844,4354,5895,6164,7430,1061,2334,4921,5656,6185,7470'),
('960076A9', 'はちみつ砲', '1032,2048,3846,4106,5916,6164,7172,1070,2334,4132,5946,6185,7192'),
('9892A7A0', '皐月積み', '1025,2313,3331,4373,5895,6148,7462,1056,2304,4897,5433,6168,7482'),
('A026C11F', 'はちみつ砲', '1024,2054,3330,4372,5137,6147,7195,1071,2343,4664,5920,6167,7455'),
('A803499B', '迷走砲', '1032,2304,3332,4353,5894,6402,7195,1080,2343,4631,5935,6430,7456'),
('AB417000', '迷走砲', '1024,2313,3844,4354,5895,6164,7430,1081,2098,4638,5656,6436,7462'),
('B0D767E0', 'ガムシロ積み', '1024,2306,3331,4103,5908,6148,7442,1075,2334,4901,5959,6168,7200'),
('B3F94503', 'ガムシロ積み', '1024,2306,3331,4103,5908,6148,7442,1091,2353,4901,5406,6168,7200'),
('B648CDD', '皐月積み', '1031,2304,3845,4353,5915,6430,7171,1060,2313,4915,5411,6450,7191'),
('BA781180', 'はちみつ砲', '1024,2054,3330,4372,5137,6147,7195,1055,2104,4896,5669,6167,7475'),
('BC6A5958', 'ガムシロ積み', '1032,2311,3845,4380,5120,6410,7171,1081,2343,4429,5407,6179,7191'),
('C60642C6', 'ガムシロ積み', '1024,2306,3331,4103,5928,6148,7442,1044,2353,4901,5426,6168,7200'),
('C83BF49E', '迷走砲', '1024,2313,3844,4354,5895,6164,7430,1080,2334,4400,5656,6185,7204'),
('C850CD6A', '皐月積み', '1025,2313,3331,4373,5895,6148,7462,1081,2304,4128,5699,6168,7467'),
('D7580A04', 'はちみつ砲', '1032,2048,3846,4106,5916,6164,7172,1061,2098,4638,5412,6457,7192'),
('D9B806DB', '迷走砲', '1032,2304,3332,4353,5894,6402,7195,1055,2104,4631,5669,6442,7464'),
('DD22F4DE', '迷走砲', '1024,2313,3844,4354,5895,6164,7430,1061,2098,4638,5656,6448,7470'),
('E03BF8BC', 'はちみつ砲', '1032,2048,3846,4106,5916,6164,7172,1061,2334,4914,5412,6185,7192'),
('E23154FF', 'はちみつ砲', '1024,2054,3330,4372,5137,6147,7195,1084,2343,4894,5920,6167,7214'),
('E41EE4AE', '迷走砲', '1032,2304,3332,4353,5894,6402,7195,1076,2343,4631,5928,6175,7214'),
('E4AEDF2E', 'TKI積み', '1028,2048,3334,4633,5896,6156,7435,4902'),
('EC483DB9', '迷走砲', '1024,2313,3844,4354,5895,6164,7430,1061,2334,4914,5656,6185,7470'),
('EDAA19E', 'ガムシロ積み', '1032,2311,3845,4400,5120,6410,7171,1052,2344,4922,5407,6179,7191'),
('EFF0D856', '迷走砲', '1032,2304,3332,4353,5894,6402,7195,1066,2104,4631,5669,6194,7198'),
('F56C00A8', '迷走砲', '1024,2313,3844,4354,5895,6164,7430,1070,2098,4638,5656,6181,7225'),
('FE53CFC', '皐月積み', '1031,2304,3845,4353,5915,6430,7171,1084,2313,4387,5939,6436,7191');

--
-- トリガ `opener`
--
DELIMITER $$
CREATE TRIGGER `ID_INSERT` BEFORE INSERT ON `opener` FOR EACH ROW BEGIN
  SET NEW.id = HEX(CRC32(CONCAT(NEW.name,NEW.minos)));
END
$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER `ID_UPDATE` BEFORE UPDATE ON `opener` FOR EACH ROW BEGIN
  SET NEW.id = HEX(CRC32(CONCAT(NEW.name,NEW.minos)));
END
$$
DELIMITER ;

-- --------------------------------------------------------

--
-- テーブルの構造 `tags`
--

CREATE TABLE `tags` (
  `name` varchar(11) NOT NULL,
  `priority` int(11) NOT NULL,
  `color` varchar(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- テーブルのデータのダンプ `tags`
--

INSERT INTO `tags` (`name`, `priority`, `color`) VALUES
('TD系', 1101, 'blue'),
('主要', 1201, 'darkred'),
('参考', 1202, 'darkgreen'),
('右屋根', 1301, NULL),
('左屋根', 1302, NULL);

-- --------------------------------------------------------

--
-- テーブルの構造 `tag_maps`
--

CREATE TABLE `tag_maps` (
  `opener_id` varchar(11) NOT NULL,
  `tag_name` varchar(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- テーブルのデータのダンプ `tag_maps`
--

INSERT INTO `tag_maps` (`opener_id`, `tag_name`) VALUES
('10FC6E0B', 'TD系'),
('10FC6E0B', '主要'),
('10FC6E0B', '右屋根'),
('15E1B568', 'TD系'),
('15E1B568', '主要'),
('15E1B568', '右屋根'),
('1FEB7815', 'TD系'),
('1FEB7815', '参考'),
('1FEB7815', '右屋根'),
('23B8158F', 'TD系'),
('23B8158F', '主要'),
('23B8158F', '右屋根'),
('28E727FD', 'TD系'),
('28E727FD', '参考'),
('28E727FD', '右屋根'),
('2F8C5C46', 'TD系'),
('2F8C5C46', '主要'),
('2F8C5C46', '左屋根'),
('30825BEA', 'TD系'),
('30825BEA', '主要'),
('30825BEA', '右屋根'),
('31378743', 'TD系'),
('31378743', '主要'),
('31378743', '右屋根'),
('322F5852', 'TD系'),
('322F5852', '主要'),
('322F5852', '左屋根'),
('336024B2', 'TD系'),
('336024B2', '主要'),
('336024B2', '左屋根'),
('341A5D28', 'TD系'),
('341A5D28', '主要'),
('341A5D28', '左屋根'),
('3B86A49B', 'TD系'),
('3B86A49B', '主要'),
('3B86A49B', '左屋根'),
('49EC9D33', 'TD系'),
('49EC9D33', '参考'),
('49EC9D33', '右屋根'),
('4B02ED33', 'TD系'),
('4B02ED33', '主要'),
('4B02ED33', '左屋根'),
('4FDC0D06', 'TD系'),
('4FDC0D06', '主要'),
('4FDC0D06', '左屋根'),
('5FB6CD4D', 'TD系'),
('5FB6CD4D', '主要'),
('5FB6CD4D', '右屋根'),
('664FC315', 'TD系'),
('664FC315', '主要'),
('664FC315', '左屋根'),
('670D39C8', 'TD系'),
('670D39C8', '主要'),
('670D39C8', '左屋根'),
('680D57E7', 'TD系'),
('680D57E7', '参考'),
('680D57E7', '左屋根'),
('691F4048', 'TD系'),
('691F4048', '主要'),
('691F4048', '左屋根'),
('6FC7304D', 'TD系'),
('6FC7304D', '主要'),
('6FC7304D', '右屋根'),
('726ACAAE', 'TD系'),
('726ACAAE', '主要'),
('726ACAAE', '左屋根'),
('7413B3CF', 'TD系'),
('7413B3CF', '参考'),
('7413B3CF', '右屋根'),
('7A2EA849', 'TD系'),
('7A2EA849', '主要'),
('7A2EA849', '右屋根'),
('7B888F2D', 'TD系'),
('7B888F2D', '主要'),
('7B888F2D', '右屋根'),
('82553D4F', 'TD系'),
('82553D4F', '主要'),
('82553D4F', '左屋根'),
('8396D84D', 'TD系'),
('8396D84D', '参考'),
('8396D84D', '左屋根'),
('8D173318', 'TD系'),
('8D173318', '主要'),
('8D173318', '右屋根'),
('94A33995', 'TD系'),
('94A33995', '参考'),
('94A33995', '左屋根'),
('960076A9', 'TD系'),
('960076A9', '参考'),
('960076A9', '左屋根'),
('9892A7A0', 'TD系'),
('9892A7A0', '主要'),
('9892A7A0', '右屋根'),
('A026C11F', 'TD系'),
('A026C11F', '主要'),
('A026C11F', '右屋根'),
('A803499B', 'TD系'),
('A803499B', '主要'),
('A803499B', '右屋根'),
('AB417000', 'TD系'),
('AB417000', '参考'),
('AB417000', '左屋根'),
('B0D767E0', 'TD系'),
('B0D767E0', '主要'),
('B0D767E0', '右屋根'),
('B3F94503', 'TD系'),
('B3F94503', '主要'),
('B3F94503', '右屋根'),
('B648CDD', 'TD系'),
('B648CDD', '主要'),
('B648CDD', '左屋根'),
('BA781180', 'TD系'),
('BA781180', '参考'),
('BA781180', '右屋根'),
('BC6A5958', 'TD系'),
('BC6A5958', '主要'),
('BC6A5958', '左屋根'),
('C60642C6', 'TD系'),
('C60642C6', '主要'),
('C60642C6', '右屋根'),
('C83BF49E', 'TD系'),
('C83BF49E', '参考'),
('C83BF49E', '左屋根'),
('C850CD6A', 'TD系'),
('C850CD6A', '主要'),
('C850CD6A', '右屋根'),
('D7580A04', 'TD系'),
('D7580A04', '参考'),
('D7580A04', '左屋根'),
('D9B806DB', 'TD系'),
('D9B806DB', '参考'),
('D9B806DB', '右屋根'),
('DD22F4DE', 'TD系'),
('DD22F4DE', '参考'),
('DD22F4DE', '左屋根'),
('E03BF8BC', 'TD系'),
('E03BF8BC', '参考'),
('E03BF8BC', '左屋根'),
('E23154FF', 'TD系'),
('E23154FF', '主要'),
('E23154FF', '右屋根'),
('E41EE4AE', 'TD系'),
('E41EE4AE', '参考'),
('E41EE4AE', '右屋根'),
('E4AEDF2E', 'TD系'),
('E4AEDF2E', '主要'),
('E4AEDF2E', '右屋根'),
('EC483DB9', 'TD系'),
('EC483DB9', '参考'),
('EC483DB9', '左屋根'),
('EDAA19E', 'TD系'),
('EDAA19E', '主要'),
('EDAA19E', '左屋根'),
('EFF0D856', 'TD系'),
('EFF0D856', '参考'),
('EFF0D856', '右屋根'),
('F56C00A8', 'TD系'),
('F56C00A8', '参考'),
('F56C00A8', '左屋根'),
('FE53CFC', 'TD系'),
('FE53CFC', '主要'),
('FE53CFC', '左屋根');

-- --------------------------------------------------------

--
-- ビュー用の代替構造 `templates_view`
-- (実際のビューを参照するには下にあります)
--
CREATE TABLE `templates_view` (
`id` varchar(11)
,`name` text
,`tags` mediumtext
,`minos` text
);

-- --------------------------------------------------------

--
-- ビュー用の構造 `templates_view`
--
DROP TABLE IF EXISTS `templates_view`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY INVOKER VIEW `templates_view`  AS SELECT `opener`.`id` AS `id`, `opener`.`name` AS `name`, group_concat(`tags`.`name` order by `tags`.`priority` ASC separator ',') AS `tags`, `opener`.`minos` AS `minos` FROM ((`opener` left join `tag_maps` on(`opener`.`id` = `tag_maps`.`opener_id`)) left join `tags` on(`tags`.`name` = `tag_maps`.`tag_name`)) GROUP BY `opener`.`id` ORDER BY `opener`.`name` ASC, group_concat(`tags`.`priority` order by `tags`.`priority` ASC separator ',') ASC ;

--
-- ダンプしたテーブルのインデックス
--

--
-- テーブルのインデックス `opener`
--
ALTER TABLE `opener`
  ADD PRIMARY KEY (`id`);

--
-- テーブルのインデックス `tags`
--
ALTER TABLE `tags`
  ADD PRIMARY KEY (`name`);

--
-- テーブルのインデックス `tag_maps`
--
ALTER TABLE `tag_maps`
  ADD UNIQUE KEY `template_id` (`opener_id`,`tag_name`),
  ADD KEY `TAG_NAME` (`tag_name`);

--
-- ダンプしたテーブルの制約
--

--
-- テーブルの制約 `tag_maps`
--
ALTER TABLE `tag_maps`
  ADD CONSTRAINT `TAG_NAME` FOREIGN KEY (`tag_name`) REFERENCES `tags` (`name`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `TEMPLATE_ID` FOREIGN KEY (`opener_id`) REFERENCES `opener` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
